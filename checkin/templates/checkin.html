<html>
<head>
    <title>Identificação</title>
    <meta charset="utf-8">
    <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <script type="text/javascript" src="/static/js/webcam.js"></script>
	<script src="/static/js/jquery-3.6.0.min.js"></script>
    <script>
        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
          } else {
            $('#geolocation').html("Geolocatização não funcionada nesse navegador.");
          }
        }
        function showPosition(position) {
            window['latitude'] = position.coords.latitude;
            window['longitude'] = position.coords.longitude;
            $('#geolocation').html(
                "<b>Latitude</b>: " + position.coords.latitude + "<b><br>Longitude</b>: " + position.coords.longitude
            );
        }
    </script>
    <style>
        body{
            margin:10px;
        }
    </style>
</head>

<body onload="getLocation();startScan()">
    <div id="camera" style="position:absolute; top:10; right:10"></div>
    <h1>Identificação</h1>
    <h2>Facial</h2>
    <div style="text-align:center">
        <img src="https://cdn.dribbble.com/users/1332896/screenshots/3195603/scan.gif" style="max-width:90%; max-height:200px">
    </div>
    <h2>Geoespacial</h2>
    <div style="text-align:center">
        <img src="https://icon-library.com/images/position-icon/position-icon-8.jpg" style="width:100">
        <p id="geolocation">Verificando geolocalização...</p>
    </div>

    <!--
    <a class="btn btn-primary" id="btPic" href="javascript:" onclick="takeSnapShot()">Tirar Foto</a>
    -->

</body>

<script>
    function startScan(){
        var interval;
        Webcam.set({
            width: 110,
            height: 95,
            image_format: 'jpeg',
            jpeg_quality: 200
        });
        Webcam.attach('#camera');

        takeSnapShot = function () {
            Webcam.snap(function (data_uri) {
                var data = {image:data_uri, latitude:window['latitude'], longitude:window['longitude']};
                $.post("?", data, function( url ) {
                    if(url){
                        document.location.href = url;
                        clearInterval(interval);
                    }
                });
            });
        }

        Webcam.on( 'live', function() {
            interval = setInterval(takeSnapShot, 5000);
        } );

        Webcam.on( 'error', function(err) {
            alert(err);
            if(interval) clearInterval(interval);
        } );
    }
</script>
</html>